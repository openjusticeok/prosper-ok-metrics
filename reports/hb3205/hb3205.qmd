---
title: HB 3205 Impact Estimate
subtitle: Open Justice Oklahoma
format:
  ojo-report-template-html: default
  pdf:
    pdf-engine: xelatex
author: Polina Rozhkova and Brancen Gregory
date: last-modified
logo: "www/ojo-logo-white.png"
number-sections: true
smooth-scroll: true
title-block-banner: "black"
title-block-banner-color: "white"
execute: 
  freeze: auto
knitr:
  opts_chunk:
    fig.align: center
    echo: FALSE
    message: FALSE
    warning: FALSE
description: |
  Estimating the number of Oklahomans directly impacted by HB 3205, a reform of juvenile court fees. Analysis conducted at the request of [Oklahomans for Criminal Justice Reform (OCJR)](https://okjusticereform.org/) and [ProsperOK](https://www.prosperok.org/).
abstract-title: "Executive Summary"
abstract: |
  Open Justice Oklahoma estimates that between 26,654 and	32,973 Oklahomans benefitted from reduced fines and fees associated with HB 3205 between Q2 of FY 2023 and Q2 of FY 2024.
---

```{r}
library(readr)
library(stringr)
library(readxl)
library(tidycensus)
library(tidyverse)
library(here)
library(janitor)
library(glue)
library(ojoverse)
library(lubridate)
library(gt)
library(gtExtras)
library(downloadthis)
```

## Background

A bill reducing fines and fees for families of children involved in the criminal legal system (HB 3205) went into effect July 1, 2022 (Q1 FY 2023). HB 3205 struck a clause of 10A O.S. 2021, Section 2-2-301 which stated that the parent or other legal custodian were responsible for costs associated with legal representation. It limited the twenty-five dollar probation fee to only those counties that have a juvenile bureau; a provision that the fee only be applied to those with ability to pay was already in place. Prior to HB 3205 counties without a juvenile bureau were directing the revenue from this probation fee to the Office of Juvenile Affairs (OJA).

HB 3205 also struck 10A O.S. 2021, Section 2-2-509 which required a juvenile drug court user fee of up to twenty dollars per month, in addition to “court costs, treatment costs, drug-testing costs, and supervision fees”. While the cost of treatment was paid to the treatment provider, drug-testing and supervision fees were directed to the Juvenile Drug Court Revolving Fund, and all other costs and fees were directed to the court clerk.

This analysis uses OJA referral data beginning October 1, 2022 (Q2 FY 2023) to estimate the impact of HB 3205 during a period of full implementation.

## Data

```{r}
hh_estimate <- get_acs(
  geography = "county",
  survey = "acs5",
  variable = "S1101_C01_002",
  state = "OK",
  year = 2021,
  cache = TRUE
) |>
  mutate(
    NAME = str_extract(NAME, "^(.*)(?=\\sCounty,\\sOklahoma$)") |>
      str_to_title()
  ) |>
  rename(
    county = NAME
  ) |>
  mutate(
    county = case_when(
      county == "Le Flore" ~ "LeFlore",
      county == "Mcclain" ~ "McClain",
      county == "Mccurtain" ~ "McCurtain",
      county == "Mcintosh" ~ "McIntosh",
      TRUE ~ county
    )
  )

family_estimate <- get_acs(
  geography = "county",
  survey = "acs5",
  variable = "S1101_C01_004",
  state = "OK",
  year = 2021,
  cache = TRUE
) |>
  mutate(
    NAME = str_extract(NAME, "^(.*)(?=\\sCounty,\\sOklahoma$)") |>
      str_to_title()
  ) |>
  rename(
    county = NAME
  ) |>
  mutate(
    county = case_when(
      county == "Le Flore" ~ "LeFlore",
      county == "Mcclain" ~ "McClain",
      county == "Mccurtain" ~ "McCurtain",
      county == "Mcintosh" ~ "McIntosh",
      TRUE ~ county
    )
  )

# OJA data with monthly referrals 2018-2023
new_data_referrals <- read_excel(here("data", "OPI_YoungOffenders_03052024 (1).xlsx"), sheet = "Referrals") |>
  janitor::clean_names() |>
  mutate(
    month = lubridate::as_date(
      month,
      format = "%Y/%m"
    ),
    quarter = floor_date(month, "quarter"),
    fiscal_year = ojo_fiscal_year(month)
  ) |>
  mutate(
    fiscal_quarter = case_when(
      quarter(quarter) == 1 ~ 3,
      quarter(quarter) == 2 ~ 4,
      quarter(quarter) == 3 ~ 1,
      quarter(quarter) == 4 ~ 2,
      TRUE ~ NA_real_
    )
  )

```

The Office of Juvenile Affairs (OJA) provided data on youth offender referrals from `r min(new_data_referrals$month) |> format("%B %Y")` through `r max(new_data_referrals$month) |> format("%B %Y")`. The county and month in which referrals were made are included.

While referral counts provide insight into the number of Oklahoma’s youth encountering the juvenile system, they are not sufficient to estimate the number of individuals directly impacted by the reforms outlined in the section above. We used county level estimates of household and family sizes conducted by the Census in the 5-year American Community Survey to estimate the total number of individuals impacted since the burden of court fines and fees, especially in the case of children involved in the criminal legal system, is borne by families of the impacted individual.

County, rather than state, level demographics are used to account for some of the variance in the number of Oklahomans most directly involved in caring for the youth referred to OJA. Though the 5-year estimates from the Census hold household and family size constant across years, this measure was chosen due to data quality issues with the 1-year ACS associated with the Covid-19 pandemic.

According to Census definitions, household size refers to the total number of individuals living in a housing unit, while family size consists of only those housing unit residents that are related by birth, marriage, or other legal status. Aggregated, household size tends to be greater than family size; taken together, these two estimations provide reasonable bounds for estimating the total direct impact of HB 3205.

```{r}
# Correcting overestimate and assuming that each referral id represents one person (this is not always true). The previous code treated each row of data as a unique individual not taking into account that each referral id represents a "case" and each row is an individual charge. 
new_county_referrals_quarter <- new_data_referrals |>
  distinct(referral_id, .keep_all = TRUE) |>
  group_by(
    county,
    month,
    quarter,
    fiscal_year,
    fiscal_quarter
  ) |>
  count() |>
  rename(
    num_referred = n
  ) |>
  ungroup() |>
  left_join(
    hh_estimate |>
      select(
        county,
        household_size = estimate
      ),
    by = "county"
  ) |>
  left_join(
    family_estimate |>
      select(
        county,
        family_size = estimate
      ),
    by = "county"
  ) |>
  mutate(
    household_impact_estimate = num_referred * household_size,
    family_impact_estimate = num_referred * family_size
  )

```

::: {.content-visible unless-format="pdf"}

```{r}
#| column: page
## new data
gt(new_county_referrals_quarter) |>
  cols_label(
    county = "County",
    month = "Month",
    quarter = "Quarter Start",
    fiscal_year = "Fiscal Year",
    fiscal_quarter = "Fiscal Quarter",
    num_referred = "Referrals",
    household_size = "Average Household Size",
    household_impact_estimate = "Impacted Oklahomans (Low)",
    family_size = "Average Family Size",
    family_impact_estimate = "Impacted Oklahomans (High)"
  ) |>
  fmt_number(
    columns = ends_with("_estimate"),
    decimals = 0
  ) |>
  tab_footnote(
    footnote = "American Community Survey 5-Year Data (2009-2021), Households and Families (S1101)",
    locations = cells_column_labels(
      columns = c(household_size, family_size)
    )
  ) |>
  tab_source_note(
    new_county_referrals_quarter |>
      download_this(
        output_name = "updated_oja_referrals_county_quarterly",
        output_extension = ".csv"
      )
  ) |>
  tab_options(
    ihtml.active = TRUE,
    ihtml.use_filters = TRUE,
    ihtml.use_highlight = TRUE,
    ihtml.use_text_wrapping = TRUE,
    quarto.use_bootstrap = TRUE
  )

```

:::

::: {.content-visible when-format="pdf"}

See attached CSV file for full data.

:::

## Results

Quarterly referral data and estimated impacts are presented in the table below:

::: {.content-visible unless-format="pdf"}

```{r}
#| column: page
#| 
new_county_referrals_quarter |>
  filter(
    quarter >= "2022-10-01"
  ) |>
  group_by(
    fiscal_year,
    fiscal_quarter,
    quarter
  ) |>
  summarise(
    total_referred = sum(num_referred, na.rm = TRUE),
    household_impact_estimate = sum(household_impact_estimate, na.rm = TRUE),
    family_impact_estimate = sum(family_impact_estimate, na.rm = TRUE)
  ) |>
  ungroup() |>
  gt() |>
  grand_summary_rows(
    columns = c(
      total_referred,
      household_impact_estimate,
      family_impact_estimate
    ),
    fns = list(
      label = "Total",
      id = "total",
      fn = "sum"
    ),
    fmt = ~ fmt_number(., decimals = 0)
  ) |>
  cols_label(
    quarter = "Quarter Start",
    fiscal_year = "Fiscal Year",
    fiscal_quarter = "Fiscal Quarter",
    total_referred = "Referrals",
    household_impact_estimate = "Household Impact",
    family_impact_estimate = "Family Impact"
  ) |>
  fmt_number(
    columns = c("total_referred", "household_impact_estimate", "family_impact_estimate"),
    decimals = 0
  ) |> 
  gt_theme_nytimes()

```

:::
